<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EscarolaOS</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="login-screen">
        <div class="login-card"> <img src="logo.png" class="logo-img"> <div class="pin-display">
                <div class="dot" id="dot-0"></div>
                <div class="dot" id="dot-1"></div>
                <div class="dot" id="dot-2"></div>
                <div class="dot" id="dot-3"></div>
            </div>
            
            <div class="keypad">
                <button class="key" onclick="tecleo(1)">1</button>
                <button class="key" onclick="tecleo(2)">2</button>
                <button class="key" onclick="tecleo(3)">3</button>
                <button class="key" onclick="tecleo(4)">4</button>
                <button class="key" onclick="tecleo(5)">5</button>
                <button class="key" onclick="tecleo(6)">6</button>
                <button class="key" onclick="tecleo(7)">7</button>
                <button class="key" onclick="tecleo(8)">8</button>
                <button class="key" onclick="tecleo(9)">9</button>
                <button class="key" onclick="borrar()">C</button>
                <button class="key" onclick="tecleo(0)">0</button>
            </div>
        </div>
    </div>
    
    <div id="dashboard">
    <h1 style="color: var(--verde-bosque); margin-bottom: 30px; letter-spacing: 2px;">ESCAROLA<span style="color: var(--dorado);">OS</span></h1>

    <div class="finance-grid">
        <div class="stat-card-premium" id="card-ingresos">
            <div class="card-icon">üí∞</div>
            <div class="card-content">
                <span class="card-label">INGRESOS</span>
                <div class="stat-amount" id="val-ingresos">$0.00</div>
            </div>
            <button class="mini-edit-btn" onclick="abrirEditor('ingresos')">‚úé</button>
        </div>

        <div class="stat-card-premium" id="card-gastos">
            <div class="card-icon">üìâ</div>
            <div class="card-content">
                <span class="card-label">GASTOS</span>
                <div class="stat-amount" id="val-gastos" style="color: var(--terracota);">$0.00</div>
            </div>
            <button class="mini-edit-btn" onclick="abrirEditor('gastos')">‚úé</button>
        </div>

        <div class="stat-card-premium" id="card-utilidad" style="grid-column: span 2; background: linear-gradient(145deg, rgba(197,160,89,0.1), rgba(0,0,0,0.05)); border: 1px solid rgba(197,160,89,0.4);">
            <div class="card-icon" style="background: var(--dorado); color: var(--negro-profundo);">‚ú®</div>
            <div class="card-content">
                <span class="card-label" style="color: var(--dorado); opacity: 1;">UTILIDAD NETA</span>
                <div class="stat-amount" id="val-utilidad" style="font-size: 1.8rem;">$0.00</div>
            </div>
        </div>
    </div>

    <div id="seccion-admin" class="stat-card-premium" style="flex-direction: column; align-items: stretch; margin-top: 25px; padding: 0; overflow: hidden;">
        <div style="background: rgba(197, 160, 89, 0.1); padding: 15px; border-bottom: 1px solid rgba(197, 160, 89, 0.2);">
            <h3 style="color: var(--dorado); margin: 0; font-size: 1rem; display: flex; align-items: center; gap: 10px;">
                <span>üë•</span> GESTI√ìN DE COLABORADORES
            </h3>
        </div>

        <div style="padding: 20px;">
            <div class="input-group">
                <label>NOMBRE COMPLETO</label>
                <input type="text" id="reg-nombre" placeholder="Ej. Juan P√©rez" class="input-app">
            </div>

            <div class="input-group">
                <label>PIN DE ACCESO (4 D√çGITOS)</label>
                <input type="number" id="reg-pin" placeholder="0 0 0 0" class="input-app" maxlength="4">
            </div>
            
            <label style="color: var(--dorado); font-size: 0.65rem; letter-spacing: 1px; font-weight: bold; display: block; margin-bottom: 12px; text-transform: uppercase;">ASIGNAR PUESTO / ROL</label>
            <div id="selector-roles" class="rol-container">
                <button class="rol-btn" onclick="seleccionarRol('Socio', this)">üëë Socio</button>
                <button class="rol-btn" onclick="seleccionarRol('Chef', this)">üë®‚Äçüç≥ Chef</button>
                <button class="rol-btn" onclick="seleccionarRol('Barista', this)">‚òï Barista</button>
                <button class="rol-btn" onclick="seleccionarRol('Barman', this)">üç∏ Barman</button>
                <button class="rol-btn" onclick="seleccionarRol('Staff', this)">üèÉ Staff</button>
            </div>
            
            <button onclick="guardarNuevoUsuario()" class="btn-principal">
                GUARDAR EN EL SISTEMA
            </button>

            <div style="margin-top: 30px;">
                <label style="color: var(--cantera); font-size: 0.7rem; opacity: 0.5; letter-spacing: 1px;">PERSONAL REGISTRADO</label>
                <div id="lista-personal-db" style="margin-top: 10px;">
                    </div>
            </div>
        </div>
    </div>
</div>

    <script type="module">
    import { db, doc, getDoc } from './firebase-config.js';

    let pinIngresado = "";

    // Las funciones deben ser globales para que los botones las vean
    window.tecleo = (num) => {
        if (pinIngresado.length < 4) {
            pinIngresado += num;
            actualizarInterfaz();
            if (pinIngresado.length === 4) {
                setTimeout(verificarAcceso, 200);
            }
        }
    };

    window.borrar = () => {
        pinIngresado = "";
        actualizarInterfaz();
    };

    function actualizarInterfaz() {
        for (let i = 0; i < 4; i++) {
            const dot = document.getElementById(`dot-${i}`);
            dot.classList.toggle('filled', i < pinIngresado.length);
        }
    }

    async function verificarAcceso() {
        try {
            // BUSCAMOS EN FIREBASE AL SOCIO
            const docRef = doc(db, "usuarios", "socio_principal");
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const datos = docSnap.data();
                // Ejemplo de c√≥mo quedar√≠a tu validaci√≥n:
if (pinIngresado === datos.pin) {
    window.notificar("¬°Acceso Correcto! Bienvenido."); // Notificaci√≥n verde
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
} else {
    window.notificar("PIN Incorrecto. Intenta de nuevo.", true); // Notificaci√≥n terracota (roja)
    window.borrar();
}
            }
        } catch (error) {
            console.error("Error al conectar:", error);
            alert("Error de conexi√≥n con la base de datos.");
        }
    }
        // Funci√≥n simplificada de notificaciones
window.notificar = (mensaje, esError = false) => {
    const aviso = document.createElement("div");
    aviso.className = "toast";
    
    // Si es error, cambiamos el color a terracota (tu color de alerta)
    if(esError) aviso.style.backgroundColor = "var(--terracota)";
    
    aviso.innerText = mensaje;
    document.body.appendChild(aviso);

    // Se elimina autom√°ticamente tras 3 segundos
    setTimeout(() => {
        aviso.style.opacity = "0";
        aviso.style.transition = "0.5s";
        setTimeout(() => aviso.remove(), 500);
    }, 3000);
};
        // --- L√ìGICA DE SELECCI√ìN DE ROLES ---
let rolSeleccionado = ""; // Variable para guardar el rol elegido

window.seleccionarRol = (rol, elemento) => {
    // 1. Quitar el color dorado de todos los botones
    document.querySelectorAll('.rol-btn').forEach(btn => btn.classList.remove('active'));
    
    // 2. Ponerle el color dorado al que clickeaste
    elemento.classList.add('active');
    
    // 3. Guardar el nombre del rol en la variable
    rolSeleccionado = rol;
};

// --- L√ìGICA PARA GUARDAR EN FIREBASE ---
window.guardarNuevoUsuario = async () => {
    const nombre = document.getElementById('reg-nombre').value;
    const pin = document.getElementById('reg-pin').value;

    // Validaci√≥n de seguridad
    if (!nombre || pin.length !== 4 || !rolSeleccionado) {
        window.notificar("‚ö†Ô∏è Completa nombre, PIN (4 d√≠gitos) y selecciona un puesto", true);
        return;
    }

    try {
        // 'db' debe estar definido arriba en tu configuraci√≥n de Firebase
        await addDoc(collection(db, "usuarios"), {
            nombre: nombre,
            pin: pin,
            rol: rolSeleccionado,
            creado: new Date().toISOString()
        });

        window.notificar(`‚úÖ ${nombre} registrado como ${rolSeleccionado}`);

        // Limpiar el formulario para el siguiente registro
        document.getElementById('reg-nombre').value = "";
        document.getElementById('reg-pin').value = "";
        document.querySelectorAll('.rol-btn').forEach(btn => btn.classList.remove('active'));
        rolSeleccionado = "";

    } catch (error) {
        window.notificar("‚ùå Error al guardar en base de datos", true);
        console.error(error);
    }
};
</script>
</body>
</html>








